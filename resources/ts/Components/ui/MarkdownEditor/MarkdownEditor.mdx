import { Meta, Canvas, Controls } from '@storybook/blocks';
import * as MarkdownEditorStories from './MarkdownEditor.stories.tsx';

<Meta of={MarkdownEditorStories} />

# MarkdownEditor

A feature-rich Markdown editor powered by EasyMDE with support for live preview, syntax highlighting, mathematical formulas, and customizable toolbar.

## Features

- **WYSIWYG-like Experience**: Visual toolbar with instant preview
- **Math Support**: Render mathematical formulas with KaTeX ($inline$ and $$display$$)
- **Syntax Highlighting**: Code blocks with Prism.js for multiple languages
- **Customizable Toolbar**: Enable/disable specific formatting tools
- **Split View**: Side-by-side editor and preview
- **Fullscreen Mode**: Distraction-free editing
- **Auto-save**: Optional automatic content saving
- **Image Upload**: Support for image uploads (configurable)
- **Spellchecker**: Built-in spell checking
- **Shortcuts**: Keyboard shortcuts for common actions

## Installation

The component requires the following peer dependencies:

```bash
yarn add easymde katex prismjs
```

## Basic Usage

```tsx
import { MarkdownEditor } from '@examena/ui';
import { useState } from 'react';

function MyComponent() {
  const [value, setValue] = useState('');

  return (
    <MarkdownEditor
      value={value}
      onChange={setValue}
      label="Question"
      placeholder="Enter your question..."
    />
  );
}
```

## Examples

### Default Editor

Simple editor with default toolbar.

<Canvas of={MarkdownEditorStories.Default} />

### With Label and Help Text

Editor with descriptive label and help text.

<Canvas of={MarkdownEditorStories.WithLabel} />

### Pre-filled Content

Editor initialized with rich content.

<Canvas of={MarkdownEditorStories.WithContent} />

### Required Field

Validation with required field indicator.

<Canvas of={MarkdownEditorStories.Required} />

### Error State

Display validation errors.

<Canvas of={MarkdownEditorStories.WithError} />

### Disabled State

Read-only mode.

<Canvas of={MarkdownEditorStories.Disabled} />

### Minimal Toolbar

Simplified toolbar with only essential tools.

<Canvas of={MarkdownEditorStories.MinimalToolbar} />

### Math-Focused

Optimized for mathematical content.

<Canvas of={MarkdownEditorStories.MathFocused} />

### Custom Height

Extended editor area.

<Canvas of={MarkdownEditorStories.CustomHeight} />

### All Features Enabled

Complete example with all formatting options.

<Canvas of={MarkdownEditorStories.WithAllFeatures} />

## Props

<Controls />

## Toolbar Features

### Text Formatting
- `enableBold` - Bold text (**text**)
- `enableItalic` - Italic text (*text*)
- `enableStrikethrough` - Strikethrough (~~text~~)
- `enableHeading` - Headings (# H1, ## H2, etc.)

### Lists
- `enableUnorderedList` - Bullet lists (-)
- `enableOrderedList` - Numbered lists (1.)

### Links & Media
- `enableLink` - Hyperlinks ([text](url))
- `enableImage` - Images (![alt](url))
- `enableTable` - Tables

### Code
- `enableCode` - Inline code and code blocks
- `enableQuote` - Blockquotes (>)

### Math (KaTeX)
- `enableMathInline` - Inline formulas ($...$)
- `enableMathDisplay` - Display formulas ($$...$$)

### View Options
- `enablePreview` - Toggle preview
- `enableSideBySide` - Split view
- `enableFullscreen` - Fullscreen mode
- `enableGuide` - Markdown guide

### Utilities
- `enableUndo` - Undo action
- `enableRedo` - Redo action
- `enableHorizontalRule` - Horizontal rule (---)

## Markdown Syntax Quick Reference

### Headers
```markdown
# H1
## H2
### H3
```

### Emphasis
```markdown
**bold** or __bold__
*italic* or _italic_
~~strikethrough~~
```

### Lists
```markdown
- Unordered item
* Another item

1. Ordered item
2. Second item
```

### Links & Images
```markdown
[Link text](https://example.com)
![Alt text](image-url.jpg)
```

### Code
````markdown
Inline `code`

```language
code block
```
````

### Math
```markdown
Inline: $E = mc^2$

Display:
$$\int_0^\infty e^{-x^2} dx = \frac{\sqrt{\pi}}{2}$$
```

### Tables
```markdown
| Header 1 | Header 2 |
|----------|----------|
| Cell 1   | Cell 2   |
```

### Blockquotes
```markdown
> This is a quote
> - Author
```

## Keyboard Shortcuts

| Action | Shortcut |
|--------|----------|
| Bold | Ctrl/Cmd + B |
| Italic | Ctrl/Cmd + I |
| Link | Ctrl/Cmd + K |
| Image | Ctrl/Cmd + Alt + I |
| Preview | Ctrl/Cmd + P |
| Fullscreen | F11 |
| Side by Side | F9 |

## Advanced Features

### Custom Toolbar

```tsx
<MarkdownEditor
  customToolbar={[
    'bold',
    'italic',
    '|',
    'heading-1',
    'heading-2',
    '|',
    'code',
    'quote',
    '|',
    'preview',
  ]}
/>
```

### Image Upload

```tsx
<MarkdownEditor
  enableImageUpload
  imageUploadEndpoint="/api/upload"
  imageMaxSize={5 * 1024 * 1024} // 5MB
  imageUploadFunction={(file, onSuccess, onError) => {
    // Custom upload logic
    const formData = new FormData();
    formData.append('image', file);
    
    fetch('/api/upload', {
      method: 'POST',
      body: formData,
    })
      .then(res => res.json())
      .then(data => onSuccess(data.url))
      .catch(err => onError(err.message));
  }}
/>
```

### Editor Methods (via ref)

```tsx
import { useRef } from 'react';

const editorRef = useRef<MarkdownEditorHandle>(null);

// Access editor methods
editorRef.current?.getValue();
editorRef.current?.setValue('New content');
editorRef.current?.insertText('Inserted text');
editorRef.current?.clearValue();
editorRef.current?.focus();
```

## Accessibility

- Full keyboard navigation
- ARIA labels for all toolbar buttons
- Screen reader friendly
- Focus management
- High contrast mode support

## Performance Tips

1. **Debounce onChange**: For large documents, consider debouncing the onChange callback
2. **Lazy Loading**: Load editor only when needed
3. **Disable Unused Features**: Only enable required toolbar items
4. **Optimize Images**: Use image optimization before upload

## Related Components

- [ChoiceEditor](../?path=/docs/ui-forms-choiceeditor--docs) - Dual-mode editor for choices
- [MarkdownRenderer](../?path=/docs/ui-display-markdownrenderer--docs) - Display Markdown content
- [Input](../?path=/docs/ui-forms-input--docs) - Simple text input
- [Textarea](../?path=/docs/ui-forms-textarea--docs) - Multi-line text input
